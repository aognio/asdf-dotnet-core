#!/usr/bin/env bash

# Set default channel to STS if not provided
DEFAULT_CHANNEL=${DEFAULT_DOTNET_CORE_CHANNEL:-STS}

echo "Downloading the CLI installer"

DOWNLOADER=$(which curl)

# Download the .NET install script
$DOWNLOADER -sSL https://dot.net/v1/dotnet-install.sh > "$ASDF_INSTALL_PATH/dotnet-install.sh"

chmod +x "$ASDF_INSTALL_PATH/dotnet-install.sh"

echo "Installing the CLI requested version $ASDF_INSTALL_VERSION. Please wait, installation may take a few minutes."

# Run the .NET install script with the specified or default channel
"$ASDF_INSTALL_PATH/dotnet-install.sh" --install-dir "$ASDF_INSTALL_PATH" --channel $DEFAULT_CHANNEL --version "$ASDF_INSTALL_VERSION" --no-path

# Clean up the install script
rm "$ASDF_INSTALL_PATH/dotnet-install.sh"

# Check if installation was successful
if [ $? -ne 0 ]; then
    echo "Download of version $ASDF_INSTALL_VERSION of the CLI failed. Exiting now."
    exit 1
fi

echo "The CLI has been installed."

